<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåà Ryaleason üì∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Lalezar&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #FFE6F2;
            font-family: 'Lalezar', cursive;
            color: #FF69B4;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
    
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
    
        .camera-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
    
        h1 {
            text-shadow: 2px 2px 4px rgba(255, 105, 180, 0.3);
            font-size: 2em;
            margin-bottom: 20px;
        }
    
        video {
            transform: scaleX(-1);
            border: 5px solid #FF69B4;
            border-radius: 15px;
            width: 100%;
            max-width: 300px;
            height: auto;
        }
    
        .controls,
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
    
        button {
            background-color: #FF69B4;
            border: none;
            color: white;
            padding: 6px 20px;
            border-radius: 20px;
            cursor: pointer;
            margin-top: 10px;
            transition: transform 0.2s;
            font-family: 'Lalezar', cursive;
        }
    
        button:hover {
            transform: scale(1.1);
            background-color: #FF1493;
        }
    
        .photo-strip {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            background-color: #FFB6C1;
            max-width: 90%;
        }
    
        .photo-strip img {
            width: 100px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }
    
        .countdown {
            font-size: 2em;
            color: #FF69B4;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }
    
        #backgroundColorPicker {
            width: 40px;
            height: 40px;
            border: none;
            margin-top: 20px;
            border-radius: 50%;
            cursor: pointer;
        }
    
        @media (min-width: 768px) {
            .container {
                justify-content: center;
                gap: 20px;
            }
    
            .photo-strip {
                max-width: 350px;
                display: flex;
                flex-direction: column;
            }
    
            .photo-strip img {
                width: 250px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="camera-section">
            <h1>üåà PhotoBooth üì∏</h1>
            <video id="video" autoplay></video>
    
            <div class="controls">
                <button onclick="startPhotoSession()">‚ú® Mulai Foto ‚ú®</button>
                <input type="color" id="backgroundColorPicker" value="#FFB6C1" title="Choose Background Color">
            </div>
    
            <div class="countdown" id="countdown"></div>
    
            <div class="filters">
                <button onclick="applyFilter('grayscale(100%)')">üåö Grayscale</button>
                <button onclick="applyFilter('sepia(100%)')">üçö Sepia</button>
                <button onclick="applyFilter('hue-rotate(90deg)')">üåà Rainbow</button>
                <button onclick="applyFilter('none')">üîÑ Reset</button>
            </div>
    
            <button onclick="downloadPhotoStrip()">üíæ Download Foto Disini</button>
        </div>
    
        <div class="photo-strip" id="photoStrip"></div>
    </div>

    <script>
        const video = document.getElementById('video');
        const photoStrip = document.getElementById('photoStrip');
        const countdownEl = document.getElementById('countdown');
        const backgroundColorPicker = document.getElementById('backgroundColorPicker');
        let filter = 'none';
        let photoDetails = [];

        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => { video.srcObject = stream; })
            .catch(err => alert("üôà Oops! Camera access denied. Please check permissions."));

        function startPhotoSession() {
            photoStrip.innerHTML = '';
            photoDetails = [];
            takePhotoWithCountdown(0);
        }

        function takePhotoWithCountdown(photoIndex) {
            if (photoIndex >= 3) return;

            let count = 3;
            countdownEl.textContent = count;

            const countdownInterval = setInterval(() => {
                count--;
                if (count > 0) {
                    countdownEl.textContent = count;
                } else {
                    countdownEl.textContent = '';
                    clearInterval(countdownInterval);
                    capturePhoto(photoIndex, () => {
                        takePhotoWithCountdown(photoIndex + 1);
                    });
                }
            }, 1000);
        }

        function capturePhoto(photoIndex, callback) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = video.videoWidth / 2;
            canvas.height = video.videoHeight / 2;
            ctx.translate(canvas.width, 0);
            ctx.scale(-1, 1);

            ctx.filter = filter;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

            const img = document.createElement('img');
            img.src = canvas.toDataURL('image/png');
            img.style.filter = filter;
            photoStrip.appendChild(img);

            photoDetails.push({
                dataUrl: img.src,
                filter: filter
            });

            if (callback) callback();
        }

        function applyFilter(newFilter) {
            filter = newFilter;
            const images = photoStrip.getElementsByTagName('img');
            for (let img of images) {
                img.style.filter = newFilter;
            }
        }

        function downloadPhotoStrip() {
            const stripCanvas = document.createElement('canvas');
            const ctx = stripCanvas.getContext('2d');

            if (photoDetails.length === 0) return;

            const images = photoDetails.map(detail => {
                const img = new Image();
                img.src = detail.dataUrl;
                return { img, filter: detail.filter };
            });

            const imgWidth = video.videoWidth / 2;
            const imgHeight = video.videoHeight / 2;

            const borderWidth = 20;
            const borderRadius = 10;
            const shadowBlur = 6;
            const shadowOffset = 4;
            const gap = 10;

            stripCanvas.width = imgWidth + 2 * borderWidth;
            stripCanvas.height = imgHeight * images.length + (images.length - 1) * gap + 2 * borderWidth;

            ctx.fillStyle = backgroundColorPicker.value;
            ctx.fillRect(0, 0, stripCanvas.width, stripCanvas.height);

            function roundedRect(ctx, x, y, width, height, radius) {
                ctx.beginPath();
                ctx.moveTo(x + radius, y);
                ctx.arcTo(x + width, y, x + width, y + height, radius);
                ctx.arcTo(x + width, y + height, x, y + height, radius);
                ctx.arcTo(x, y + height, x, y, radius);
                ctx.arcTo(x, y, x + width, y, radius);
                ctx.closePath();
            }

            Promise.all(images.map(item => new Promise(resolve => {
                item.img.onload = () => resolve(item);
            }))).then(loadedImages => {
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');

                loadedImages.forEach((item, index) => {
                    const x = borderWidth;
                    const y = borderWidth + index * (imgHeight + gap);

                    ctx.shadowColor = 'rgba(0, 0, 0, 1)';
                    ctx.shadowBlur = shadowBlur;
                    ctx.shadowOffsetX = shadowOffset;
                    ctx.shadowOffsetY = shadowOffset;

                    ctx.save();
                    roundedRect(ctx, x, y, imgWidth, imgHeight, borderRadius);
                    ctx.clip();

                    ctx.shadowColor = 'transparent';
                    ctx.shadowBlur = 0;
                    ctx.shadowOffsetX = 0;
                    ctx.shadowOffsetY = 0;

                    tempCanvas.width = imgWidth;
                    tempCanvas.height = imgHeight;
                    tempCtx.filter = item.filter;
                    tempCtx.drawImage(item.img, 0, 0, imgWidth, imgHeight);

                    ctx.drawImage(
                        tempCanvas,
                        x,
                        y,
                        imgWidth,
                        imgHeight
                    );

                    ctx.restore();
                });


                const link = document.createElement('a');
                link.download = 'üåà_photobooth_memories.png';
                link.href = stripCanvas.toDataURL('image/png');
                link.click();
            });
        }

        backgroundColorPicker.addEventListener('input', function () {
            photoStrip.style.backgroundColor = this.value;
        });
    </script>
</body>